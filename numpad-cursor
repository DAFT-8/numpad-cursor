#!/bin/bash

command -v sxhkd > /dev/null 2>&1 || { echo >&2 "I require sxhkd but it's not installed. Install it. Aborting."; exit 1; }

CONFIG_DIR="$HOME/.config/sxhkd"
CONFIG_FILE="$CONFIG_DIR/sxhkdrc"
HELPER="/tmp/numpad-cursor-helper"

mkdir -p "$CONFIG_DIR"

cat > "$HELPER" <<'EOS'
#!/bin/bash
dx="$1"
dy="$2"
steps=14
delay=0.006
for i in $(seq 1 $steps); do
    xdotool mousemove_relative -- "$dx" "$dy"
    sleep "$delay"
done
EOS

chmod +x "$HELPER"

cat > "$CONFIG_FILE" <<EOF
# Smooth default move (speed 8)
KP_8
    $HELPER 0 -8
KP_Up
    $HELPER 0 -8

KP_2
    $HELPER 0 8
KP_Down
    $HELPER 0 8

KP_4
    $HELPER -8 0
KP_Left
    $HELPER -8 0

KP_6
    $HELPER 8 0
KP_Right
    $HELPER 8 0

# Clicks
KP_5
    xdotool click 1
KP_Begin
    xdotool click 1

KP_Enter
    xdotool click 3
EOF

echo "# Config written to $CONFIG_FILE"
echo "# Helper script written to $HELPER"

pkill sxhkd 2>/dev/null
sxhkd -c "$CONFIG_FILE" &
echo "# sxhkd started with default smooth speed (8)"
